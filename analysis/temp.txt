ALASKA & GEORGIA GHG ANALYSIS AND DOWNSCALING
A reproducible pipeline for sectoral inventories, downscaling, projections, and scenarios (1990–2030)

Author: 
Repository: Intended for GitHub distribution
Script: all_in_one.R
Scope: Alaska (AK) and Georgia (GA)

====================================================================
EXECUTIVE SUMMARY
====================================================================
This white paper documents a fully reproducible R workflow that ingests state-level greenhouse gas (GHG) data, produces required analytics and visualizations for AK and GA, performs Alaska 2022 downscaling to county/borough level for selected sectors, and builds trend-based projections (2023–2030) plus abatement scenarios for Industry and Transportation. The pipeline is encapsulated in a single R script—all_in_one.R—and outputs all tables and figures into an outputs/ directory, ready for publication or additional analysis.

Key deliverables include:
- Task 1–5 Excel tables for AK & GA (sector totals; AK means; LULUCF; summed totals; and LULUCF-adjusted totals).
- Figures 1–5 for stacked areas, sector means, and trend lines (AK vs GA) with clear labels and units.
- Alaska 2022 downscaling for Industry, Transportation, and Residential using share-based allocation from Downscale.xlsx.
- BAU projections (2023–2030) for all AK sectors using a trend-strength rule.
- Scenario trajectories for Industry & Transportation that ramp linearly from the 2022 baseline to −15% and −20% by 2030.

All emissions are reported as: Emissions (MMT CO2 eq.).

====================================================================
DATA & INPUTS
====================================================================
1) GHG INVENTORY WORKBOOK
File: data/AllStateGHGData.xlsx
Sheet of interest: Data by Economic Sectors
Years covered: 1990–2022
Sectors: Agriculture; Commercial; Electric Power Industry; Industry; LULUCF Sector Net Total; Residential; Transport/Transportation
Note: LULUCF is excluded in Tasks 1, 2, and 4; it is handled separately (Task 3) and then added (Task 5).

Expected columns (flexible naming, auto-detected by script):
- State column (e.g., geo_ref, state, State).
- Sector column (e.g., econ_sector, Sector).
- Year columns either wide (e.g., 1990, Y1991, …) or long (Year, Value).

2) DOWNSCALE WORKBOOK (ALASKA ONLY)
File: data/Downscale.xlsx
Sheets: Industry, Transportation, Residential (names are auto-matched; custom names can be set via environment variables).
Each sheet’s rightmost column (or a column literally named Total) is used as the proxy for that geography’s share. The first non-Total column is the name (borough/census area).

3) ALASKA POPULATION (OPTIONAL)
File: data/Alaska_Population.xlsx (or .csv)
Columns: Year, Population (or wide years that the script reshapes automatically). Used only for correlation scatterplots vs. AK total emissions (excl. LULUCF).

====================================================================
PROCESSING OVERVIEW
====================================================================
The all_in_one.R script performs the following steps:
1. Read and normalize the GHG workbook (detect state/sector/year columns; melt wide year headers).
2. Canonicalize sector totals per (State, Sector, Year), preferring sub-sector sums when present.
3. Build Task 1–5 tables and Figures 1–5 (see specifications below).
4. Optional: join AK totals with population and generate 2 scatterplots.
5. Downscale Alaska 2022 for Industry, Transportation, and Residential with share-based allocation.
6. Project AK sectors to 2030 via time-series linear modeling with method selection by trend strength.
7. Build abatement scenarios (Industry & Transportation) with linear ramps from 2022 baseline to −15% and −20% by 2030.

All results are written to outputs/tables/ and outputs/figures/.

====================================================================
TASK SPECIFICATIONS & OUTPUTS
====================================================================
TASK 1 — Sector Totals by Year (excl. LULUCF)
Goal: Annual totals for each sector for AK and GA.
Output: outputs/tables/task1_sector_totals_by_year.xlsx (sheets: AK, GA).

TASK 2 — AK Sector Means (1990–2022, excl. LULUCF)
Goal: Mean emissions across years for each AK sector.
Output: outputs/tables/task2_ak_means_by_sector.xlsx (sheet: AK_Means_By_Sector).

TASK 3 — LULUCF Sector Net Total (AK & GA)
Goal: LULUCF net totals for both states.
Output: outputs/tables/task3_lulucf_net_total_ak_ga.xlsx (sheet: LULUCF_Net_Total).

TASK 4 — Summed Emissions excl. LULUCF (AK & GA)
Goal: Annual summed emissions across sectors excluding LULUCF.
Output: outputs/tables/task4_summed_excl_lulucf_ak_ga.xlsx (sheet: Summed_No_LULUCF).

TASK 5 — Adjusted Totals = (Sum excl. LULUCF) + (LULUCF Net Total)
Goal: Add back LULUCF net totals to get adjusted totals.
Output: outputs/tables/task5_adjusted_totals_ak_ga.xlsx (sheet: Adjusted_Totals; columns: AK_Adjusted_Total, GA_Adjusted_Total).

A combined workbook (outputs/tables/All_Tasks_Summary.xlsx) aggregates the above.

====================================================================
FIGURE SPECIFICATIONS & OUTPUTS
====================================================================
1. Stacked Area by Sector (AK & GA) — fig1_stacked_area_AK.png, fig1_stacked_area_GA.png
   - Sectors stacked (excl. LULUCF). Y-axis unit: Emissions (MMT CO2 eq.).

2. AK Sector Means — fig2_bar_ak_means.png
   - Mean across 1990–2022 (excl. LULUCF). Horizontal bar chart with units.

3. LULUCF Trend (AK vs GA) — fig3_trend_lulucf.png
   - Two-line comparison with units.

4. Summed excl. LULUCF Trend (AK vs GA) — fig4_trend_summed.png
   - Two-line comparison with units.

5. Adjusted Totals Trend (AK vs GA) — fig5_trend_adjusted.png
   - Two-line comparison; adjusted totals with units.

Projections and scenarios (AK only):
- Historical + BAU facets by sector — ak_sector_bau_facets.png
  Solid = Historical (1990–2022); Dotted = BAU (2023–2030). Units and bold facet labels included.
- Industry & Transportation scenarios (faceted) — ak_industry_transport_scenarios.png
  BAU + −15% and −20% (reductions are not dotted).
- Industry & Transportation (combined) — ak_it_scenarios_combined.png
  Color = Scenario (BAU, −15%, −20%); Linetype = Sector (Industry vs Transportation).

====================================================================
DOWNSCALING (ALASKA, 2022)
====================================================================
Objective: Allocate Alaska’s 2022 sector totals to counties/boroughs via proportional shares derived from data/Downscale.xlsx.

Method:
1. Retrieve 2022 sector totals for Industry, Transportation, Residential from Task 1 (AK).
2. For each sector’s sheet in Downscale.xlsx:
   - Use the rightmost column (or a column named Total) as proxy.
   - Compute each row’s Share = Total_i / Sum(Total).
   - Scale by the 2022 sector total: Allocated_i = Share * SectorTotal_2022.
3. Output results:
   - outputs/tables/ak_downscale_2022_by_sector.xlsx — sheets for each sector.
   - outputs/tables/ak_downscale_2022_by_sector.csv — long-format table.

Note: If the Downscale.xlsx tab names differ, the script auto-detects close matches; you can override via environment variables.

====================================================================
PROJECTIONS (ALASKA, 2023–2030)
====================================================================
Sector-Level Time Series Modeling:
- For each AK sector (excl. LULUCF), fit a linear regression of Emissions on Year: Emissions = b0 + b1 * t, where t is calendar year.
- Evaluate trend strength and stability:
  - Strong trend: use Full-Period Linear (1990–2022) if R^2 ≥ 0.4 and p < 0.05.
  - Weak/unstable: use Recent 5-year linear fit (e.g., 2018–2022).
- BAU projections are predicted for 2023–2030.

Outputs:
- outputs/tables/ak_sector_bau_projections_2023_2030.csv
- outputs/tables/ak_sector_bau_projections_2023_2030.xlsx (Sheets: BAU_Projections, Metrics, Scenarios_IT)

====================================================================
SCENARIOS (ALASKA: INDUSTRY & TRANSPORTATION)
====================================================================
Objective: Provide abatement trajectories to compare against BAU.

Design: For Industry and Transportation, create two linear ramps from the 2022 baseline to 2030 targets:
- −15% of 2022 by 2030
- −20% of 2022 by 2030

These ramps are monotonic and independent of BAU growth (they do not track BAU year-to-year). In plots, reductions are not dotted; sector identity is shown by line type in the combined figure.

Outputs:
- outputs/tables/ak_industry_transport_scenarios_2023_2030.csv
- outputs/figures/ak_industry_transport_scenarios.png (faceted)
- outputs/figures/ak_it_scenarios_combined.png (combined)

====================================================================
OPTIONAL: INTERACTIVE EXPLORATION
====================================================================
A small Shiny app can be used to query by Sector and Sub-sector and filter by Year. You can adapt it to read the normalized outputs from outputs/tables for a robust explorer.

====================================================================
REPRODUCIBILITY & HOW TO RUN
====================================================================
Requirements:
- R >= 4.1
- Packages: readxl, dplyr, tidyr, stringr, ggplot2, openxlsx

Install:
install.packages(c("readxl","dplyr","tidyr","stringr","ggplot2","openxlsx"),
                 repos = "https://cloud.r-project.org")

Run:
setwd("C:/AllStateGHG")      # adjust to your project root
source("all_in_one.R")       # or: Rscript all_in_one.R

Configuration via Environment Variables (optional):
Sys.setenv(
  GHG_INPUT_FILE = "data/AllStateGHGData.xlsx",
  GHG_SHEET_NAME = "Data by Economic Sectors",
  POP_FILE       = "data/Alaska_Population.xlsx",
  POP_SHEET      = NA,
  DOWNSCALE_X    = "data/Downscale.xlsx",
  DOWNSCALE_SHEET_INDUSTRY       = "",
  DOWNSCALE_SHEET_TRANSPORTATION = "",
  DOWNSCALE_SHEET_RESIDENTIAL    = "",
  OUTDIR         = "outputs"
)

====================================================================
QUALITY CHECKS & NOTES
====================================================================
- Units: All y-axes labeled Emissions (MMT CO2 eq.).
- Sector harmonization: The script normalizes labels (e.g., Transport to Transportation) where needed.
- LULUCF handling: Excluded from sector totals/means; handled separately in Task 3 and added back in Task 5.
- Scenario logic: Ramps reference the 2022 baseline, ensuring monotonic decline to targets by 2030.
- Edge cases: Empty or malformed rows are safely coerced; non-numeric symbols are stripped when parsing numeric totals.

====================================================================
LIMITATIONS & ASSUMPTIONS
====================================================================
- Trend-selection thresholds (R^2 and p-value) are heuristic and may be tuned by sector.
- Linear projections do not capture structural changes, policy shifts, or technology adoption.
- Downscaling assumes the proxy totals in Downscale.xlsx are representative of relative emissions shares.
- Data quality and sector definitions must be consistent across years for robust modeling.

====================================================================
SUGGESTED EXTENSIONS
====================================================================
- Incorporate uncertainty bands around projections (e.g., bootstrap or prediction intervals).
- Support non-linear trend fitting (e.g., piecewise, ARIMA) with model selection via AIC/BIC.
- Integrate VMT panel data for transportation to refine downscaling and validation.
- Package the pipeline as an R package with unit tests and CI (e.g., GitHub Actions).

====================================================================
FILE MAP (OUTPUTS)
====================================================================
outputs/
  tables/
    task1_sector_totals_by_year.xlsx
    task2_ak_means_by_sector.xlsx
    task3_lulucf_net_total_ak_ga.xlsx
    task4_summed_excl_lulucf_ak_ga.xlsx
    task5_adjusted_totals_ak_ga.xlsx
    All_Tasks_Summary.xlsx
    ak_sector_bau_projections_2023_2030.csv
    ak_sector_bau_projections_2023_2030.xlsx
    ak_industry_transport_scenarios_2023_2030.csv
    ak_downscale_2022_by_sector.xlsx
    ak_downscale_2022_by_sector.csv
  figures/
    fig1_stacked_area_AK.png
    fig1_stacked_area_GA.png
    fig2_bar_ak_means.png
    fig3_trend_lulucf.png
    fig4_trend_summed.png
    fig5_trend_adjusted.png
    ak_sector_bau_facets.png
    ak_industry_transport_scenarios.png
    ak_it_scenarios_combined.png

====================================================================
LICENSE
====================================================================
MIT (or your preferred license).

====================================================================
CONTACT
====================================================================
Please open an issue/PR with reproducible details (R script version, package versions, input sheet names/headers) for support or enhancements.
